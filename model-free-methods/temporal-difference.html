<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">Temporal Difference | Reinforcement Learning Notes</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://thereconpilot.github.io/rl-notes/model-free-methods/temporal-difference"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Temporal Difference | Reinforcement Learning Notes"><meta data-react-helmet="true" name="description" content="Temporal Difference (TD) Learning is a general class of model-free methods, which combines the ideas of Monte-Carlo and Dynamic Programming (DP)."><meta data-react-helmet="true" property="og:description" content="Temporal Difference (TD) Learning is a general class of model-free methods, which combines the ideas of Monte-Carlo and Dynamic Programming (DP)."><link data-react-helmet="true" rel="shortcut icon" href="/rl-notes/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://thereconpilot.github.io/rl-notes/model-free-methods/temporal-difference"><link data-react-helmet="true" rel="alternate" href="https://thereconpilot.github.io/rl-notes/model-free-methods/temporal-difference" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://thereconpilot.github.io/rl-notes/model-free-methods/temporal-difference" hreflang="x-default"><link rel="stylesheet" href="/rl-notes/assets/css/styles.0db5a581.css">
<link rel="preload" href="/rl-notes/assets/js/runtime~main.69f2a18c.js" as="script">
<link rel="preload" href="/rl-notes/assets/js/main.10c0a611.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rl-notes/"><div class="navbar__logo"><img src="/rl-notes/img/logo.svg" alt="Site Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/rl-notes/img/logo.svg" alt="Site Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Reinforcement Learning Notes</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/TheReconPilot/rl-notes" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ğŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ğŸŒ</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rl-notes/">Reinforcement Learning</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tabular Methods</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Rewards and GPI</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Model-free methods</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rl-notes/model-free-methods/monte-carlo">Monte-Carlo Methods</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rl-notes/model-free-methods/temporal-difference">Temporal Difference</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Approximate Solution Methods</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rl-notes/resources">Resources</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Temporal Difference</h1></header><p>Temporal Difference (TD) Learning is a general class of model-free methods, which combines the ideas of Monte-Carlo and Dynamic Programming (DP).</p><p>Like Monte-Carlo methods, TD methods can learn directly from raw experience without a model of the environment&#x27;s dynamics.</p><p>While Monte-Carlo methods only adjust their estimates once the final outcome is known, TD methods adjust estimates based in part on other learned estimates, without waiting for the final outcome (similar to DP).</p><p>This is a form of bootstrapping, as illustrated in this example from <a href="https://en.wikipedia.org/wiki/Temporal_difference_learning" target="_blank" rel="noopener noreferrer">Wikipedia</a>:</p><blockquote><p>Suppose you wish to predict the weather for Saturday, and you have some model that predicts Saturday&#x27;s weather, given the weather of each day in the week. In the standard case, you would wait until Saturday and then adjust all your models. However, when it is, for example, Friday, you should have a pretty good idea of what the weather would be on Saturday â€“ and thus be able to change, say, Saturday&#x27;s model before Saturday arrives.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_31ik" id="the-idea">The Idea<a aria-hidden="true" class="hash-link" href="#the-idea" title="Direct link to heading">â€‹</a></h2><p>Recall the Optimality Equation for action value function, using which we can improve <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Q(s, a)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">a</span><span class="mclose">)</span></span></span></span></span> iteratively</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mstyle mathsize="1.2em"><munder><munder><mrow><mi>Q</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mi>t</mi></msub><mo separator="true">,</mo><msub><mi>a</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mrow><mo stretchy="true">âŸ</mo></munder><mrow><mi>Q</mi><mo>âˆ—</mo><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo></mrow></munder><mo>â†</mo><mi><munder><mo><mi mathvariant="double-struck">E</mi></mo><mrow><msub><mi>r</mi><mi>t</mi></msub><mo separator="true">,</mo><msub><mi>s</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow></munder></mi><mrow><mo fence="true">[</mo><msub><mi>r</mi><mi>t</mi></msub><mo>+</mo><mi>Î³</mi><munder><mo><mi>max</mi><mo>â¡</mo></mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></munder><mi>Q</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo stretchy="false">)</mo><mo fence="true">]</mo></mrow></mstyle></mrow><annotation encoding="application/x-tex">\large \underbrace{Q(s_t, a_t)}_{Q*(s, a)} \gets \underset{r_t, s_{t+1}}{\mathbb{E}}\left[ r_t + \gamma \max_{a&#x27;}Q(s_{t+1}, a&#x27;) \right]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.0176em;vertical-align:-2.1176em"></span><span class="mord munder sizing reset-size6 size7"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.75em"><span style="top:-1.402em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">Q</span><span class="mbin mtight">âˆ—</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">s</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">a</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.75em"><span class="svg-align" style="top:-2.102em"><span class="pstrut" style="height:3em"></span><span class="stretchy" style="height:0.548em;min-width:1.6em"><span class="brace-left" style="height:0.548em"><svg width="400em" height="0.548em" viewBox="0 0 400000 548" preserveAspectRatio="xMinYMin slice"><path d="M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13
 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688
 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7
-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z"></path></svg></span><span class="brace-center" style="height:0.548em"><svg width="400em" height="0.548em" viewBox="0 0 400000 548" preserveAspectRatio="xMidYMin slice"><path d="M199572 214
c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14
 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3
 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0
-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z"></path></svg></span><span class="brace-right" style="height:0.548em"><svg width="400em" height="0.548em" viewBox="0 0 400000 548" preserveAspectRatio="xMaxYMin slice"><path d="M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3
 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237
-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z"></path></svg></span></span></span><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34206400000000003em"><span style="top:-2.65em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size6 size4 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34206400000000003em"><span style="top:-2.65em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size6 size4 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.898em"><span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.7646666666666668em"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel sizing reset-size6 size7">â†</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:2.514398em;vertical-align:-1.004398em"></span><span class="mord sizing reset-size6 size7"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.68889em"><span style="top:-2.6000000000000005em;margin-left:0em"><span class="pstrut" style="height:3.2em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31830999999999987em"><span style="top:-2.4570000000000003em;margin-left:-0.02778em;margin-right:0.0625em"><span class="pstrut" style="height:2.6em"></span><span class="sizing reset-size4 size2 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3403299999999999em"><span style="top:-2.4570000000000003em;margin-left:0em;margin-right:0.0625em"><span class="pstrut" style="height:2.6em"></span><span class="sizing reset-size4 size2 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.20549749999999997em"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.2em"><span class="pstrut" style="height:3.2em"></span><span><span class="mop"><span class="mord"><span class="mord mathbb">E</span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8369983333333333em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="minner sizing reset-size6 size7"><span class="mopen sizing reset-size7 size6 delimcenter" style="top:-0.04999999999999999em"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.26005333333333336em"><span style="top:-2.65em;margin-left:-0.02778em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mord mathnormal" style="margin-right:0.05556em">Î³</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.43055999999999994em"><span style="top:-2.5655533333333334em;margin-left:0em"><span class="pstrut" style="height:3.2em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7026699999999999em"><span style="top:-2.886em;margin-right:0.0625em"><span class="pstrut" style="height:2.6em"></span><span class="sizing reset-size4 size2 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.2em"><span class="pstrut" style="height:3.2em"></span><span><span class="mop">max</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7344466666666667em"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em"><span style="top:-2.6499999999999995em;margin-left:0em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.20555333333333334em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7833733333333334em"><span style="top:-3.2129999999999996em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose sizing reset-size7 size6 delimcenter" style="top:-0.04999999999999999em"><span class="delimsizing size3">]</span></span></span></span></span></span></span></div><p>However, we don&#x27;t know the model dynamics, so we can&#x27;t find the expectation. So, we <strong>approximate by replacing expectation with sampling</strong>.</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mstyle mathsize="1.2em"><mi><munder><mo><mi mathvariant="double-struck">E</mi></mo><mrow><msub><mi>r</mi><mi>t</mi></msub><mo separator="true">,</mo><msub><mi>s</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow></munder></mi><mrow><mo fence="true">[</mo><msub><mi>r</mi><mi>t</mi></msub><mo>+</mo><mi>Î³</mi><munder><mo><mi>max</mi><mo>â¡</mo></mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></munder><mi>Q</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo stretchy="false">)</mo><mo fence="true">]</mo></mrow><mo>â‰ˆ</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><munder><mo>âˆ‘</mo><mi>i</mi></munder><mrow><mo fence="true">[</mo><msub><mi>r</mi><mi>i</mi></msub><mo>+</mo><mi>Î³</mi><munder><mo><mi>max</mi><mo>â¡</mo></mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></munder><mi>Q</mi><mo stretchy="false">(</mo><msubsup><mi>s</mi><mi>i</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msubsup><mo separator="true">,</mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo stretchy="false">)</mo><mo fence="true">]</mo></mrow></mstyle></mrow><annotation encoding="application/x-tex">\large \underset{r_t, s_{t+1}}{\mathbb{E}}\left[ r_t + \gamma \max_{a&#x27;}Q(s_{t+1}, a&#x27;) \right] \approx \frac{1}{N} \sum_{i} \left[ r_i + \gamma \max_{a&#x27;} Q(s&#x27;_i, a&#x27;) \right]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.514398em;vertical-align:-1.004398em"></span><span class="mord sizing reset-size6 size7"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.68889em"><span style="top:-2.6000000000000005em;margin-left:0em"><span class="pstrut" style="height:3.2em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31830999999999987em"><span style="top:-2.4570000000000003em;margin-left:-0.02778em;margin-right:0.0625em"><span class="pstrut" style="height:2.6em"></span><span class="sizing reset-size4 size2 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3403299999999999em"><span style="top:-2.4570000000000003em;margin-left:0em;margin-right:0.0625em"><span class="pstrut" style="height:2.6em"></span><span class="sizing reset-size4 size2 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.20549749999999997em"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.2em"><span class="pstrut" style="height:3.2em"></span><span><span class="mop"><span class="mord"><span class="mord mathbb">E</span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8369983333333333em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="minner sizing reset-size6 size7"><span class="mopen sizing reset-size7 size6 delimcenter" style="top:-0.04999999999999999em"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.26005333333333336em"><span style="top:-2.65em;margin-left:-0.02778em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mord mathnormal" style="margin-right:0.05556em">Î³</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.43055999999999994em"><span style="top:-2.5655533333333334em;margin-left:0em"><span class="pstrut" style="height:3.2em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7026699999999999em"><span style="top:-2.886em;margin-right:0.0625em"><span class="pstrut" style="height:2.6em"></span><span class="sizing reset-size4 size2 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.2em"><span class="pstrut" style="height:3.2em"></span><span><span class="mop">max</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7344466666666667em"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em"><span style="top:-2.6499999999999995em;margin-left:0em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.20555333333333334em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7833733333333334em"><span style="top:-3.2129999999999996em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose sizing reset-size7 size6 delimcenter" style="top:-0.04999999999999999em"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel sizing reset-size6 size7">â‰ˆ</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:3.09255em;vertical-align:-1.506822em"></span><span class="mord sizing reset-size6 size7"><span class="mopen nulldelimiter sizing reset-size7 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em"><span style="top:-2.5140000000000002em"><span class="pstrut" style="height:3.2em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em">N</span></span></span><span style="top:-3.43em"><span class="pstrut" style="height:3.2em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.8770000000000002em"><span class="pstrut" style="height:3.2em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size7 size6"></span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mop op-limits sizing reset-size6 size7"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em"><span style="top:-2.044315em;margin-left:0em"><span class="pstrut" style="height:3.2em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span style="top:-3.200005em"><span class="pstrut" style="height:3.2em"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.2556850000000002em"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="minner sizing reset-size6 size7"><span class="mopen sizing reset-size7 size6 delimcenter" style="top:-0.04999999999999999em"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.28968000000000005em"><span style="top:-2.65em;margin-left:-0.02778em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mord mathnormal" style="margin-right:0.05556em">Î³</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.43055999999999994em"><span style="top:-2.5655533333333334em;margin-left:0em"><span class="pstrut" style="height:3.2em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7026699999999999em"><span style="top:-2.886em;margin-right:0.0625em"><span class="pstrut" style="height:2.6em"></span><span class="sizing reset-size4 size2 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.2em"><span class="pstrut" style="height:3.2em"></span><span><span class="mop">max</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7344466666666667em"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7833733333333333em"><span style="top:-2.553em;margin-left:0em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.2129999999999996em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7833733333333334em"><span style="top:-3.2129999999999996em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose sizing reset-size7 size6 delimcenter" style="top:-0.04999999999999999em"><span class="delimsizing size3">]</span></span></span></span></span></span></span></div><p>And we use moving average with just one sample:</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mstyle mathsize="1.44em"><mi>Q</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mi>t</mi></msub><mo separator="true">,</mo><msub><mi>a</mi><mi>t</mi></msub><mo stretchy="false">)</mo><mo>â†</mo><mi>Î±</mi><mo stretchy="false">(</mo><msub><mi>r</mi><mi>t</mi></msub><mo>+</mo><mi>Î³</mi><munder><mo><mi>max</mi><mo>â¡</mo></mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></munder><mi>Q</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>âˆ’</mo><mi>Î±</mi><mo stretchy="false">)</mo><mi>Q</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mi>t</mi></msub><mo separator="true">,</mo><msub><mi>a</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\Large Q(s_t, a_t) \gets \alpha (r_t + \gamma \max_{a&#x27;} Q(s_{t+1}, a&#x27;)) + (1-\alpha) Q(s_t, a_t)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.44em;vertical-align:-0.36em"></span><span class="mord mathnormal sizing reset-size6 size8">Q</span><span class="mopen sizing reset-size6 size8">(</span><span class="mord sizing reset-size6 size8"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2771388888888888em"><span style="top:-2.85em;margin-left:0em;margin-right:0.034722222222222224em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct sizing reset-size6 size8">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord sizing reset-size6 size8"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2771388888888888em"><span style="top:-2.85em;margin-left:0em;margin-right:0.034722222222222224em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size8">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel sizing reset-size6 size8">â†</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.44em;vertical-align:-0.36em"></span><span class="mord mathnormal sizing reset-size6 size8" style="margin-right:0.0037em">Î±</span><span class="mopen sizing reset-size6 size8">(</span><span class="mord sizing reset-size6 size8"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2771388888888888em"><span style="top:-2.85em;margin-left:-0.02778em;margin-right:0.034722222222222224em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin sizing reset-size6 size8">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:2.2112119999999997em;vertical-align:-1.060932em"></span><span class="mord mathnormal sizing reset-size6 size8" style="margin-right:0.05556em">Î³</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mop op-limits sizing reset-size6 size8"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.43055999999999983em"><span style="top:-2.8032416666666666em;margin-left:0em"><span class="pstrut" style="height:3.44em"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6778919999999999em"><span style="top:-2.9890000000000003em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.44em"><span class="pstrut" style="height:3.44em"></span><span><span class="mop">max</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7367583333333334em"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size8">Q</span><span class="mopen sizing reset-size6 size8">(</span><span class="mord sizing reset-size6 size8"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2975277777777777em"><span style="top:-2.85em;margin-left:0em;margin-right:0.034722222222222224em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.20786805555555554em"><span></span></span></span></span></span></span><span class="mpunct sizing reset-size6 size8">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord sizing reset-size6 size8"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7988055555555555em"><span style="top:-3.413em;margin-right:0.034722222222222224em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size8">)</span><span class="mclose sizing reset-size6 size8">)</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin sizing reset-size6 size8">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.44em;vertical-align:-0.36em"></span><span class="mopen sizing reset-size6 size8">(</span><span class="mord sizing reset-size6 size8">1</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin sizing reset-size6 size8">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.44em;vertical-align:-0.36em"></span><span class="mord mathnormal sizing reset-size6 size8" style="margin-right:0.0037em">Î±</span><span class="mclose sizing reset-size6 size8">)</span><span class="mord mathnormal sizing reset-size6 size8">Q</span><span class="mopen sizing reset-size6 size8">(</span><span class="mord sizing reset-size6 size8"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2771388888888888em"><span style="top:-2.85em;margin-left:0em;margin-right:0.034722222222222224em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct sizing reset-size6 size8">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord sizing reset-size6 size8"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2771388888888888em"><span style="top:-2.85em;margin-left:0em;margin-right:0.034722222222222224em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size8">)</span></span></span></span></span></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="q-learning">Q-learning<a aria-hidden="true" class="hash-link" href="#q-learning" title="Direct link to heading">â€‹</a></h2><p>Q-learning is a TD method.</p><ul><li>Initialize <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Q(s, a)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">a</span><span class="mclose">)</span></span></span></span></span> with zeros</li><li>Loop:<ul><li>Sample <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo separator="true">,</mo><mi>r</mi><mo separator="true">,</mo><msup><mi>s</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">&lt; s, a, r, s&#x27; &gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.946332em;vertical-align:-0.19444em"></span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">&gt;</span></span></span></span></span> from the environment</li><li>Compute <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="1.2em"><mover accent="true"><mi>Q</mi><mo>^</mo></mover><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>=</mo><mi>r</mi><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>+</mo><mi>Î³</mi><munder><mo><mi>max</mi><mo>â¡</mo></mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></munder><mi>Q</mi><mo stretchy="false">(</mo><msup><mi>s</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo separator="true">,</mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\large\hat{Q}(s, a) = r(s, a) + \gamma \max\limits_{a&#x27;}Q(s&#x27;, a&#x27;)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.436124em;vertical-align:-0.3em"></span><span class="mord accent sizing reset-size6 size7"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9467699999999999em"><span style="top:-3.2em"><span class="pstrut" style="height:3.2em"></span><span class="mord"><span class="mord mathnormal">Q</span></span></span><span style="top:-3.4523300000000003em"><span class="pstrut" style="height:3.2em"></span><span class="accent-body" style="left:-0.16666em"><span class="mord">^</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em"><span></span></span></span></span></span><span class="mopen sizing reset-size6 size7">(</span><span class="mord mathnormal sizing reset-size6 size7">s</span><span class="mpunct sizing reset-size6 size7">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size7">a</span><span class="mclose sizing reset-size6 size7">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel sizing reset-size6 size7">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.3em"></span><span class="mord mathnormal sizing reset-size6 size7" style="margin-right:0.02778em">r</span><span class="mopen sizing reset-size6 size7">(</span><span class="mord mathnormal sizing reset-size6 size7">s</span><span class="mpunct sizing reset-size6 size7">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size7">a</span><span class="mclose sizing reset-size6 size7">)</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin sizing reset-size6 size7">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.781336em;vertical-align:-0.881336em"></span><span class="mord mathnormal sizing reset-size6 size7" style="margin-right:0.05556em">Î³</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mop op-limits sizing reset-size6 size7"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.43055999999999994em"><span style="top:-2.5655533333333334em;margin-left:0em"><span class="pstrut" style="height:3.2em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7026699999999999em"><span style="top:-2.886em;margin-right:0.0625em"><span class="pstrut" style="height:2.6em"></span><span class="sizing reset-size4 size2 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.2em"><span class="pstrut" style="height:3.2em"></span><span><span class="mop">max</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7344466666666667em"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size7">Q</span><span class="mopen sizing reset-size6 size7">(</span><span class="mord sizing reset-size6 size7"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7333733333333334em"><span style="top:-3.163em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mpunct sizing reset-size6 size7">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord sizing reset-size6 size7"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7333733333333334em"><span style="top:-3.163em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size7">)</span></span></span></span></span></li><li>Update <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="1.2em"><mi>Q</mi><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>â†</mo><mi>Î±</mi><mover accent="true"><mi>Q</mi><mo>^</mo></mover><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>âˆ’</mo><mi>Î±</mi><mo stretchy="false">)</mo><mi>Q</mi><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\large Q(s, a) \gets \alpha \hat{Q}(s, a) + (1-\alpha) Q(s, a)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.3em"></span><span class="mord mathnormal sizing reset-size6 size7">Q</span><span class="mopen sizing reset-size6 size7">(</span><span class="mord mathnormal sizing reset-size6 size7">s</span><span class="mpunct sizing reset-size6 size7">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size7">a</span><span class="mclose sizing reset-size6 size7">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel sizing reset-size6 size7">â†</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.436124em;vertical-align:-0.3em"></span><span class="mord mathnormal sizing reset-size6 size7" style="margin-right:0.0037em">Î±</span><span class="mord accent sizing reset-size6 size7"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9467699999999999em"><span style="top:-3.2em"><span class="pstrut" style="height:3.2em"></span><span class="mord"><span class="mord mathnormal">Q</span></span></span><span style="top:-3.4523300000000003em"><span class="pstrut" style="height:3.2em"></span><span class="accent-body" style="left:-0.16666em"><span class="mord">^</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em"><span></span></span></span></span></span><span class="mopen sizing reset-size6 size7">(</span><span class="mord mathnormal sizing reset-size6 size7">s</span><span class="mpunct sizing reset-size6 size7">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size7">a</span><span class="mclose sizing reset-size6 size7">)</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin sizing reset-size6 size7">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.3em"></span><span class="mopen sizing reset-size6 size7">(</span><span class="mord sizing reset-size6 size7">1</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin sizing reset-size6 size7">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.3em"></span><span class="mord mathnormal sizing reset-size6 size7" style="margin-right:0.0037em">Î±</span><span class="mclose sizing reset-size6 size7">)</span><span class="mord mathnormal sizing reset-size6 size7">Q</span><span class="mopen sizing reset-size6 size7">(</span><span class="mord mathnormal sizing reset-size6 size7">s</span><span class="mpunct sizing reset-size6 size7">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size7">a</span><span class="mclose sizing reset-size6 size7">)</span></span></span></span></span></li></ul></li></ul><p>Even before we finish our first trajectory, we would end up with something better than random Q-values. This is helpful in situations where we have infinite processing or situations with no apparent termination criteria for the session.</p><p>Q-learning can take all those situations and learn towards a better policy without even finishing.</p><hr><h2 class="anchor anchorWithStickyNavbar_31ik" id="exploration-vs-exploitation">Exploration vs Exploitation<a aria-hidden="true" class="hash-link" href="#exploration-vs-exploitation" title="Direct link to heading">â€‹</a></h2><p>Using Q-learning in a naive way could lead to issues. For example, at the very start, all Q-values are zero (or as per initialization). Whatever first action taken by the agent that has a positive reward automatically gets reinforced and preferred by the algorithm.</p><p>We again come to this issue, that <em>if our agent always takes the &#x27;best&#x27; actions from its current point of view, how will it ever learn that other actions may be better than the current best one?</em></p><p>In other words, this is the issue of Exploring new actions vs Exploiting the current best ones for reward.</p><p>There are multiple strategies.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="epsilon-greedy"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ïµ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathnormal">Ïµ</span></span></span></span></span>-greedy<a aria-hidden="true" class="hash-link" href="#epsilon-greedy" title="Direct link to heading">â€‹</a></h3><p>We take random action with probability <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ïµ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathnormal">Ïµ</span></span></span></span></span>, otherwise the current optimal action.</p><p>However, we don&#x27;t always want to keep exploring. After a sufficient number of iterations, we have a pretty good idea of the optimal actions, and so, one way is to discount this <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ïµ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathnormal">Ïµ</span></span></span></span></span> with each iteration, so that we take fewer exploration turns over time.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="softmax">Softmax<a aria-hidden="true" class="hash-link" href="#softmax" title="Direct link to heading">â€‹</a></h3><p>The softmax function is a function often used to take an input vector of real numbers and normalize it into a probability distribution, proportional to the exponentials of the input numbers.</p><p>Here, it can be used to convert action values into action probabilities. The function commonly used is:</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mstyle mathsize="1.44em"><msub><mi>P</mi><mi>t</mi></msub><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>exp</mi><mo>â¡</mo><mrow><mo fence="true">(</mo><mfrac><mrow><msub><mi>q</mi><mi>t</mi></msub><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo></mrow><mi>Ï„</mi></mfrac><mo fence="true">)</mo></mrow></mrow><mrow><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>exp</mi><mo>â¡</mo><mrow><mo fence="true">(</mo><mfrac><mrow><msub><mi>q</mi><mi>t</mi></msub><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow><mi>Ï„</mi></mfrac><mo fence="true">)</mo></mrow></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\Large P_t(a) = \frac{\exp\left(\frac{q_t(a)}{\tau}\right)}{\sum\limits_{i=1}^{n} \exp\left(\frac{q_t(i)}{\tau}\right)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.44em;vertical-align:-0.36em"></span><span class="mord sizing reset-size6 size8"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2771388888888888em"><span style="top:-2.85em;margin-left:-0.13889em;margin-right:0.034722222222222224em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen sizing reset-size6 size8">(</span><span class="mord mathnormal sizing reset-size6 size8">a</span><span class="mclose sizing reset-size6 size8">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel sizing reset-size6 size8">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:6.1483644em;vertical-align:-3.1867344em"></span><span class="mord sizing reset-size6 size8"><span class="mopen nulldelimiter sizing reset-size8 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0566875000000002em"><span style="top:-2.200995em"><span class="pstrut" style="height:3.44em"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.349005em"><span style="top:-2.565995em;margin-left:0em"><span class="pstrut" style="height:3.44em"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.4400049999999998em"><span class="pstrut" style="height:3.44em"></span><span><span class="mop op-symbol small-op">âˆ‘</span></span></span><span style="top:-4.390005em;margin-left:0em"><span class="pstrut" style="height:3.44em"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.974005em"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mop">exp</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="minner"><span class="mopen sizing reset-size8 size6 delimcenter" style="top:-0.10999999999999999em"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter sizing reset-size8 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0044444444444445em"><span style="top:-2.6550000000000002em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.1132em">Ï„</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.483611111111111em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size8 size6"></span></span><span class="mclose sizing reset-size8 size6 delimcenter" style="top:-0.10999999999999999em"><span class="delimsizing size3">)</span></span></span></span></span><span style="top:-3.67em"><span class="pstrut" style="height:3.44em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-4.379743055555556em"><span class="pstrut" style="height:3.44em"></span><span class="mord"><span class="mop">exp</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="minner"><span class="mopen sizing reset-size8 size6 delimcenter" style="top:-0.10999999999999999em"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter sizing reset-size8 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0044444444444445em"><span style="top:-2.6550000000000002em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.1132em">Ï„</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.483611111111111em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">a</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size8 size6"></span></span><span class="mclose sizing reset-size8 size6 delimcenter" style="top:-0.10999999999999999em"><span class="delimsizing size3">)</span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.21301em"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size8 size6"></span></span></span></span></span></span></div><p>The parameter <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï„</mi></mrow><annotation encoding="application/x-tex">\tau</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.1132em">Ï„</span></span></span></span></span> is called a <em>temperature parameter</em>. For high temperatures (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï„</mi><mo>â†’</mo><mi mathvariant="normal">âˆ</mi></mrow><annotation encoding="application/x-tex">\tau \to \infty</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.1132em">Ï„</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord">âˆ</span></span></span></span></span>), all actions have nearly the same probability, and the lower the temperature, the actions with higher expected rewards have higher probability. For a low temperature (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï„</mi><mo>â†’</mo><msup><mn>0</mn><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">\tau \to 0^+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.1132em">Ï„</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.771331em;vertical-align:0em"></span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.771331em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span></span>), the probability of the action with the highest expected reward tends to 1.</p><hr><h2 class="anchor anchorWithStickyNavbar_31ik" id="sarsa">SARSA<a aria-hidden="true" class="hash-link" href="#sarsa" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="cliff-walking---example">Cliff Walking - Example<a aria-hidden="true" class="hash-link" href="#cliff-walking---example" title="Direct link to heading">â€‹</a></h3><p><img src="https://i.imgur.com/JQ7FC4K.png"></p><p>We have a robot, wanting to reach from the yellow square to the green square, and it is on a cliff.</p><p>The red squares depict falling off the cliff with a negative reward. </p><p>There is a shorter path (red arrow) which leads us to the destination faster, but has a higher risk (falling off while exploring). And there is a longer, but much safer path (green arrow), which has a lower return <!-- -->[because of discounting by gamma]<!-- -->.</p><p>While using Q-Learning, our robot learns to use the shorter path, but also likely falls down often.</p><p>Robots are expensive, we would be better off with having a safer path, even if it is somewhat longer. We don&#x27;t want to rebuild one everytime it falls off the cliff.</p><p>It is in situations like this that SARSA method comes in.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="the-method">The Method<a aria-hidden="true" class="hash-link" href="#the-method" title="Direct link to heading">â€‹</a></h3><p>We follow the same update rule:</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mstyle mathsize="1.2em"><mi>Q</mi><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>â†</mo><mi>Î±</mi><mover accent="true"><mi>Q</mi><mo>^</mo></mover><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>âˆ’</mo><mi>Î±</mi><mo stretchy="false">)</mo><mi>Q</mi><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\large Q(s, a) \gets \alpha \hat{Q}(s, a) + (1-\alpha) Q(s, a)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.3em"></span><span class="mord mathnormal sizing reset-size6 size7">Q</span><span class="mopen sizing reset-size6 size7">(</span><span class="mord mathnormal sizing reset-size6 size7">s</span><span class="mpunct sizing reset-size6 size7">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size7">a</span><span class="mclose sizing reset-size6 size7">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel sizing reset-size6 size7">â†</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.436124em;vertical-align:-0.3em"></span><span class="mord mathnormal sizing reset-size6 size7" style="margin-right:0.0037em">Î±</span><span class="mord accent sizing reset-size6 size7"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9467699999999999em"><span style="top:-3.2em"><span class="pstrut" style="height:3.2em"></span><span class="mord"><span class="mord mathnormal">Q</span></span></span><span style="top:-3.4523300000000003em"><span class="pstrut" style="height:3.2em"></span><span class="accent-body" style="left:-0.16666em"><span class="mord">^</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em"><span></span></span></span></span></span><span class="mopen sizing reset-size6 size7">(</span><span class="mord mathnormal sizing reset-size6 size7">s</span><span class="mpunct sizing reset-size6 size7">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size7">a</span><span class="mclose sizing reset-size6 size7">)</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin sizing reset-size6 size7">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.3em"></span><span class="mopen sizing reset-size6 size7">(</span><span class="mord sizing reset-size6 size7">1</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin sizing reset-size6 size7">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.3em"></span><span class="mord mathnormal sizing reset-size6 size7" style="margin-right:0.0037em">Î±</span><span class="mclose sizing reset-size6 size7">)</span><span class="mord mathnormal sizing reset-size6 size7">Q</span><span class="mopen sizing reset-size6 size7">(</span><span class="mord mathnormal sizing reset-size6 size7">s</span><span class="mpunct sizing reset-size6 size7">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size7">a</span><span class="mclose sizing reset-size6 size7">)</span></span></span></span></span></div><p>The difference comes in how we compute <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>Q</mi><mo>^</mo></mover><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\hat{Q}(s, a)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.19677em;vertical-align:-0.25em"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9467699999999999em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">Q</span></span></span><span style="top:-3.25233em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.16666em"><span class="mord">^</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">a</span><span class="mclose">)</span></span></span></span></span>.</p><p><strong>Q-Learning</strong></p><p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="1.2em"><mover accent="true"><mi>Q</mi><mo>^</mo></mover><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>=</mo><mi>r</mi><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>+</mo><mi>Î³</mi><munder><mo><mi>max</mi><mo>â¡</mo></mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></munder><mi>Q</mi><mo stretchy="false">(</mo><msup><mi>s</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo separator="true">,</mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\large\hat{Q}(s, a) = r(s, a) + \gamma \max\limits_{a&#x27;}Q(s&#x27;, a&#x27;)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.436124em;vertical-align:-0.3em"></span><span class="mord accent sizing reset-size6 size7"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9467699999999999em"><span style="top:-3.2em"><span class="pstrut" style="height:3.2em"></span><span class="mord"><span class="mord mathnormal">Q</span></span></span><span style="top:-3.4523300000000003em"><span class="pstrut" style="height:3.2em"></span><span class="accent-body" style="left:-0.16666em"><span class="mord">^</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em"><span></span></span></span></span></span><span class="mopen sizing reset-size6 size7">(</span><span class="mord mathnormal sizing reset-size6 size7">s</span><span class="mpunct sizing reset-size6 size7">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size7">a</span><span class="mclose sizing reset-size6 size7">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel sizing reset-size6 size7">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.3em"></span><span class="mord mathnormal sizing reset-size6 size7" style="margin-right:0.02778em">r</span><span class="mopen sizing reset-size6 size7">(</span><span class="mord mathnormal sizing reset-size6 size7">s</span><span class="mpunct sizing reset-size6 size7">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size7">a</span><span class="mclose sizing reset-size6 size7">)</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin sizing reset-size6 size7">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.781336em;vertical-align:-0.881336em"></span><span class="mord mathnormal sizing reset-size6 size7" style="margin-right:0.05556em">Î³</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mop op-limits sizing reset-size6 size7"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.43055999999999994em"><span style="top:-2.5655533333333334em;margin-left:0em"><span class="pstrut" style="height:3.2em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7026699999999999em"><span style="top:-2.886em;margin-right:0.0625em"><span class="pstrut" style="height:2.6em"></span><span class="sizing reset-size4 size2 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.2em"><span class="pstrut" style="height:3.2em"></span><span><span class="mop">max</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7344466666666667em"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size7">Q</span><span class="mopen sizing reset-size6 size7">(</span><span class="mord sizing reset-size6 size7"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7333733333333334em"><span style="top:-3.163em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mpunct sizing reset-size6 size7">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord sizing reset-size6 size7"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7333733333333334em"><span style="top:-3.163em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size7">)</span></span></span></span></span></p><p><strong>SARSA</strong></p><p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="1.2em"><mover accent="true"><mi>Q</mi><mo>^</mo></mover><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>=</mo><mi>r</mi><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>+</mo><mi>Î³</mi><mi>Q</mi><mo stretchy="false">(</mo><msup><mi>s</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo separator="true">,</mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\large\hat{Q}(s, a) = r(s, a) + \gamma Q(s&#x27;, a&#x27;)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.436124em;vertical-align:-0.3em"></span><span class="mord accent sizing reset-size6 size7"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9467699999999999em"><span style="top:-3.2em"><span class="pstrut" style="height:3.2em"></span><span class="mord"><span class="mord mathnormal">Q</span></span></span><span style="top:-3.4523300000000003em"><span class="pstrut" style="height:3.2em"></span><span class="accent-body" style="left:-0.16666em"><span class="mord">^</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em"><span></span></span></span></span></span><span class="mopen sizing reset-size6 size7">(</span><span class="mord mathnormal sizing reset-size6 size7">s</span><span class="mpunct sizing reset-size6 size7">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size7">a</span><span class="mclose sizing reset-size6 size7">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel sizing reset-size6 size7">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.3em"></span><span class="mord mathnormal sizing reset-size6 size7" style="margin-right:0.02778em">r</span><span class="mopen sizing reset-size6 size7">(</span><span class="mord mathnormal sizing reset-size6 size7">s</span><span class="mpunct sizing reset-size6 size7">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size7">a</span><span class="mclose sizing reset-size6 size7">)</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin sizing reset-size6 size7">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.3em"></span><span class="mord mathnormal sizing reset-size6 size7" style="margin-right:0.05556em">Î³</span><span class="mord mathnormal sizing reset-size6 size7">Q</span><span class="mopen sizing reset-size6 size7">(</span><span class="mord sizing reset-size6 size7"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7333733333333334em"><span style="top:-3.163em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mpunct sizing reset-size6 size7">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord sizing reset-size6 size7"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7333733333333334em"><span style="top:-3.163em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size7">)</span></span></span></span></span></p><p>This is also called an <em>on-policy</em> control method, while Q-learning is called an <em>off-policy</em> control method.</p><p>On-policy simply means using the current policy (i.e. do actions recommended by the current policy). Off-policy means we may use some action not recommended by the current policy, or maybe use a different policy altogether (say, a sample run from an expert) for training.</p><ul><li>In Q-Learning, we sample <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo separator="true">,</mo><mi>r</mi><mo separator="true">,</mo><msup><mi>s</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">&lt;s, a, r, s&#x27;&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.946332em;vertical-align:-0.19444em"></span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">&gt;</span></span></span></span></span> from the environment, then we use a max operator over all <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mrow><annotation encoding="application/x-tex">a&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span> to find the best action in a greedy sense.</li><li>In SARSA, we sample <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo separator="true">,</mo><mi>r</mi><mo separator="true">,</mo><msup><mi>s</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo separator="true">,</mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">&lt;s, a, r, s&#x27;, a&#x27;&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.946332em;vertical-align:-0.19444em"></span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">&gt;</span></span></span></span></span> (hence the name) and use it directly. We follow the policy.</li></ul><p>The idea of SARSA is well-explained in <a href="https://stackoverflow.com/a/49390009" target="_blank" rel="noopener noreferrer">a StackOverflow answer by Dennis Soemers</a>.</p><blockquote><ul><li><p><strong>SARSA</strong> uses the behaviour policy (meaning, the policy used by the agent to generate experience in the environment, which is typically <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Îµ</mi></mrow><annotation encoding="application/x-tex">\varepsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathnormal">Îµ</span></span></span></span></span>-greedy) to select an additional action <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mrow><annotation encoding="application/x-tex">a&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span>, and then uses <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><mo stretchy="false">(</mo><msup><mi>s</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo separator="true">,</mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Q(s&#x27;, a&#x27;)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.001892em;vertical-align:-0.25em"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span> (discounted by <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î³</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em"></span><span class="mord mathnormal" style="margin-right:0.05556em">Î³</span></span></span></span></span>) as expected future returns in the computation of the update target.</p></li><li><p><strong>Q-Learning</strong> does not use the behaviour policy to select an additional action <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mrow><annotation encoding="application/x-tex">a&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span>. Instead, it estimates the expected future returns in the update rule as <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><munder><mo><mi>max</mi><mo>â¡</mo></mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></munder><mi>Q</mi><mo stretchy="false">(</mo><msup><mi>s</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo separator="true">,</mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\max\limits_{a&#x27;}Q(s&#x27;, a&#x27;)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.495872em;vertical-align:-0.7439800000000001em"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.43055999999999983em"><span style="top:-2.35602em;margin-left:0em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em"><span style="top:-2.786em;margin-right:0.07142857142857144em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span><span class="mop">max</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7439800000000001em"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>. The max operator used here can be viewed as &quot;following&quot; the completely greedy policy. <strong>The agent is not actually following the greedy policy</strong> though; it only says, in the update rule, &quot;suppose that I would start following the greedy policy from now on, what would my expected future returns be then?&quot;.</p></li></ul></blockquote><blockquote><p><strong>What does it mean intuitively?</strong></p></blockquote><blockquote><ul><li><p>SARSA will converge to a solution that is optimal under the assumption that we keep following the same policy that was used to generate the experience. This will often be a policy with some element of (rather &quot;stupid&quot;) randomness, like epsilon-greedy, because otherwise we are unable to guarantee that we&#x27;ll converge to anything at all.</p></li><li><p>Q-Learning will converge to a solution that is optimal under the assumption that, after generating experience and training, we switch over to the greedy policy.</p></li></ul></blockquote><blockquote><p><strong>When to use which algorithm?</strong></p></blockquote><blockquote><p>An algorithm like Sarsa is typically preferable in situations where we care about the agent&#x27;s performance during the process of learning / generating experience.</p></blockquote><p>Like, the expensive robot, which we don&#x27;t want to fall off a cliff too often during learning.</p><blockquote><p>An algorithm like Q-learning would be preferable in situations where we do not care about the agent&#x27;s performance during the training process, but we just want it to learn an optimal greedy policy that we&#x27;ll switch to eventually. Consider, for example, that we play a few practice games (where we don&#x27;t mind losing due to randomness sometimes), and afterwards play an important tournament (where we&#x27;ll stop learning and switch over from epsilon-greedy to the greedy policy). This is where Q-learning would be better.</p></blockquote><p>Another useful answer on <a href="https://stats.stackexchange.com/questions/326788/when-to-choose-sarsa-vs-q-learning" target="_blank" rel="noopener noreferrer">When to choose SARSA vs Q-Learning by Neil Slater</a></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="expected-sarsa">Expected SARSA<a aria-hidden="true" class="hash-link" href="#expected-sarsa" title="Direct link to heading">â€‹</a></h2><p>In Expected SARSA, we replace the max operator of Q-Learning with an Expectation over the actions. Here&#x27;s the comparison.</p><p><strong>Q-Learning</strong></p><p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="1.2em"><mover accent="true"><mi>Q</mi><mo>^</mo></mover><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>=</mo><mi>r</mi><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>+</mo><mi>Î³</mi><munder><mo><mi>max</mi><mo>â¡</mo></mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></munder><mi>Q</mi><mo stretchy="false">(</mo><msup><mi>s</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo separator="true">,</mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\large\hat{Q}(s, a) = r(s, a) + \gamma \max\limits_{a&#x27;}Q(s&#x27;, a&#x27;)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.436124em;vertical-align:-0.3em"></span><span class="mord accent sizing reset-size6 size7"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9467699999999999em"><span style="top:-3.2em"><span class="pstrut" style="height:3.2em"></span><span class="mord"><span class="mord mathnormal">Q</span></span></span><span style="top:-3.4523300000000003em"><span class="pstrut" style="height:3.2em"></span><span class="accent-body" style="left:-0.16666em"><span class="mord">^</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em"><span></span></span></span></span></span><span class="mopen sizing reset-size6 size7">(</span><span class="mord mathnormal sizing reset-size6 size7">s</span><span class="mpunct sizing reset-size6 size7">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size7">a</span><span class="mclose sizing reset-size6 size7">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel sizing reset-size6 size7">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.3em"></span><span class="mord mathnormal sizing reset-size6 size7" style="margin-right:0.02778em">r</span><span class="mopen sizing reset-size6 size7">(</span><span class="mord mathnormal sizing reset-size6 size7">s</span><span class="mpunct sizing reset-size6 size7">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size7">a</span><span class="mclose sizing reset-size6 size7">)</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin sizing reset-size6 size7">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.781336em;vertical-align:-0.881336em"></span><span class="mord mathnormal sizing reset-size6 size7" style="margin-right:0.05556em">Î³</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mop op-limits sizing reset-size6 size7"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.43055999999999994em"><span style="top:-2.5655533333333334em;margin-left:0em"><span class="pstrut" style="height:3.2em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7026699999999999em"><span style="top:-2.886em;margin-right:0.0625em"><span class="pstrut" style="height:2.6em"></span><span class="sizing reset-size4 size2 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.2em"><span class="pstrut" style="height:3.2em"></span><span><span class="mop">max</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7344466666666667em"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size7">Q</span><span class="mopen sizing reset-size6 size7">(</span><span class="mord sizing reset-size6 size7"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7333733333333334em"><span style="top:-3.163em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mpunct sizing reset-size6 size7">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord sizing reset-size6 size7"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7333733333333334em"><span style="top:-3.163em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size7">)</span></span></span></span></span></p><p><strong>SARSA</strong></p><p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="1.2em"><mover accent="true"><mi>Q</mi><mo>^</mo></mover><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>=</mo><mi>r</mi><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>+</mo><mi>Î³</mi><mi>Q</mi><mo stretchy="false">(</mo><msup><mi>s</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo separator="true">,</mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\large\hat{Q}(s, a) = r(s, a) + \gamma Q(s&#x27;, a&#x27;)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.436124em;vertical-align:-0.3em"></span><span class="mord accent sizing reset-size6 size7"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9467699999999999em"><span style="top:-3.2em"><span class="pstrut" style="height:3.2em"></span><span class="mord"><span class="mord mathnormal">Q</span></span></span><span style="top:-3.4523300000000003em"><span class="pstrut" style="height:3.2em"></span><span class="accent-body" style="left:-0.16666em"><span class="mord">^</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em"><span></span></span></span></span></span><span class="mopen sizing reset-size6 size7">(</span><span class="mord mathnormal sizing reset-size6 size7">s</span><span class="mpunct sizing reset-size6 size7">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size7">a</span><span class="mclose sizing reset-size6 size7">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel sizing reset-size6 size7">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.3em"></span><span class="mord mathnormal sizing reset-size6 size7" style="margin-right:0.02778em">r</span><span class="mopen sizing reset-size6 size7">(</span><span class="mord mathnormal sizing reset-size6 size7">s</span><span class="mpunct sizing reset-size6 size7">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size7">a</span><span class="mclose sizing reset-size6 size7">)</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin sizing reset-size6 size7">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.3em"></span><span class="mord mathnormal sizing reset-size6 size7" style="margin-right:0.05556em">Î³</span><span class="mord mathnormal sizing reset-size6 size7">Q</span><span class="mopen sizing reset-size6 size7">(</span><span class="mord sizing reset-size6 size7"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7333733333333334em"><span style="top:-3.163em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mpunct sizing reset-size6 size7">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord sizing reset-size6 size7"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7333733333333334em"><span style="top:-3.163em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size7">)</span></span></span></span></span></p><p><strong>Expected SARSA</strong></p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mstyle mathsize="1.2em"><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mover accent="true"><mi>Q</mi><mo>^</mo></mover><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>r</mi><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>+</mo><mi>Î³</mi><msub><mi mathvariant="double-struck">E</mi><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></msub><mo stretchy="false">[</mo><mi>Q</mi><mo stretchy="false">(</mo><msup><mi>s</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo separator="true">,</mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo stretchy="false">)</mo><mo stretchy="false">]</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>r</mi><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>+</mo><mi>Î³</mi><munder><mo>âˆ‘</mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></munder><mi>Ï€</mi><mo stretchy="false">(</mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mi mathvariant="normal">âˆ£</mi><msup><mi>s</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo stretchy="false">)</mo><mi>Q</mi><mo stretchy="false">(</mo><msup><mi>s</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo separator="true">,</mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable></mstyle></mrow><annotation encoding="application/x-tex">\large \begin{aligned} \hat{Q}(s, a) &amp;= r(s, a) + \gamma \mathbb{E}_{a&#x27;}[Q(s&#x27;, a&#x27;)] \\ \\ &amp;= r(s, a) + \gamma \sum\limits_{a&#x27;} \pi(a&#x27; | s&#x27;) Q(s&#x27;, a&#x27;) \end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:6.889472em;vertical-align:-3.1447360000000004em"></span><span class="mord sizing reset-size6 size7"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.120613333333333em"><span style="top:-5.373843333333333em"><span class="pstrut" style="height:3.2em"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9467699999999999em"><span style="top:-3.2em"><span class="pstrut" style="height:3.2em"></span><span class="mord"><span class="mord mathnormal">Q</span></span></span><span style="top:-3.4523300000000003em"><span class="pstrut" style="height:3.2em"></span><span class="accent-body" style="left:-0.16666em"><span class="mord">^</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">a</span><span class="mclose">)</span></span></span><span style="top:-3.8738433333333333em"><span class="pstrut" style="height:3.2em"></span><span class="mord"></span></span><span style="top:-2.163838333333333em"><span class="pstrut" style="height:3.2em"></span><span class="mord"></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.620613333333334em"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.120613333333333em"><span style="top:-5.373843333333333em"><span class="pstrut" style="height:3.2em"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mord mathnormal" style="margin-right:0.05556em">Î³</span><span class="mord"><span class="mord"><span class="mord mathbb">E</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31844666666666666em"><span style="top:-2.65em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7026699999999999em"><span style="top:-2.886em;margin-right:0.0625em"><span class="pstrut" style="height:2.6em"></span><span class="sizing reset-size4 size2 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7833733333333334em"><span style="top:-3.2129999999999996em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7833733333333334em"><span style="top:-3.2129999999999996em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">]</span></span></span><span style="top:-2.163838333333333em"><span class="pstrut" style="height:3.2em"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mord mathnormal" style="margin-right:0.05556em">Î³</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em"><span style="top:-2.0155483333333333em;margin-left:0em"><span class="pstrut" style="height:3.2em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7026699999999999em"><span style="top:-2.886em;margin-right:0.0625em"><span class="pstrut" style="height:2.6em"></span><span class="sizing reset-size4 size2 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.200005em"><span class="pstrut" style="height:3.2em"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.2844516666666668em"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:0.03588em">Ï€</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7833733333333334em"><span style="top:-3.2129999999999996em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7833733333333334em"><span style="top:-3.2129999999999996em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7833733333333334em"><span style="top:-3.2129999999999996em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7833733333333334em"><span style="top:-3.2129999999999996em;margin-right:0.04166666666666667em"><span class="pstrut" style="height:2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.620613333333334em"><span></span></span></span></span></span></span></span></span></span></span></span></div><p>The update rule is the same as before.</p><p>From the book:</p><blockquote><p>Expected SARSA is more computationally expensive than SARSA, but in return, it eliminates the variance due to the random selection of <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mrow><annotation encoding="application/x-tex">a&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span>. Given the same amount of experience, we might expect it to perform slightly better than SARSA, and indeed it generally does.</p></blockquote><p><img src="https://i.imgur.com/yGdgAZc.png"></p><hr><h2 class="anchor anchorWithStickyNavbar_31ik" id="experience-replay">Experience Replay<a aria-hidden="true" class="hash-link" href="#experience-replay" title="Direct link to heading">â€‹</a></h2><p>The idea of Experience Replay is to store several past interactions <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo separator="true">,</mo><mi>r</mi><mo separator="true">,</mo><msup><mi>s</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">&lt;s, a, r, s&#x27;&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.946332em;vertical-align:-0.19444em"></span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">&gt;</span></span></span></span></span>.</p><ul><li>Play 1 step and record it</li><li>Pick N random transitions to train</li></ul><p>The advantage is that we don&#x27;t need to re-visit <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(s, a)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">a</span><span class="mclose">)</span></span></span></span></span> as many times to learn.</p><p>This only works with off-policy algorithms. For example, we could use Experience Replay on Q-Learning.</p><p>Q-Learning with Experience Replay converges to a solution faster. There isn&#x27;t much of a difference in end result, just the convergence rate.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/rl-notes/model-free-methods/monte-carlo"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Monte-Carlo Methods</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/rl-notes/approximate-solution-methods/asm"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Approximate Solution Methods<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-idea" class="table-of-contents__link toc-highlight">The Idea</a></li><li><a href="#q-learning" class="table-of-contents__link toc-highlight">Q-learning</a></li><li><a href="#exploration-vs-exploitation" class="table-of-contents__link toc-highlight">Exploration vs Exploitation</a><ul><li><a href="#epsilon-greedy" class="table-of-contents__link toc-highlight">epsilon-greedy</a></li><li><a href="#softmax" class="table-of-contents__link toc-highlight">Softmax</a></li></ul></li><li><a href="#sarsa" class="table-of-contents__link toc-highlight">SARSA</a><ul><li><a href="#cliff-walking---example" class="table-of-contents__link toc-highlight">Cliff Walking - Example</a></li><li><a href="#the-method" class="table-of-contents__link toc-highlight">The Method</a></li></ul></li><li><a href="#expected-sarsa" class="table-of-contents__link toc-highlight">Expected SARSA</a></li><li><a href="#experience-replay" class="table-of-contents__link toc-highlight">Experience Replay</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/rl-notes/assets/js/runtime~main.69f2a18c.js"></script>
<script src="/rl-notes/assets/js/main.10c0a611.js"></script>
</body>
</html>